# Text2Cypher 项目配置操作步骤

## 环境准备

### 1. 创建虚拟环境
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或者 venv\Scripts\activate  # Windows
```

### 2. 安装依赖
```bash
pip install -e .
```

## 配置说明

### 1. AI模型接入 (ARK API)
项目已配置支持火山引擎ARK API，配置信息：
- **API Key**: `cb103329-5b77-418e-89f2-fea182318c91`
- **Base URL**: `https://ark.cn-beijing.volces.com/api/v3`
- **Model ID**: `ep-20250716102319-wdqpt`

### 2. Neo4j数据库配置
- **地址**: `bolt://localhost:7687`
- **用户名**: `neo4j`
- **密码**: `12345678`
- **数据库名**: `neo4j`

### 3. 环境变量设置
```bash
# ARK API 配置
export ARK_API_KEY=cb103329-5b77-418e-89f2-fea182318c91
export ARK_BASE_URL=https://ark.cn-beijing.volces.com/api/v3
export ARK_MODEL_ID=ep-20250716102319-wdqpt

# Neo4j 配置
export NEO4J_URI=bolt://localhost:7687
export NEO4J_USERNAME=neo4j
export NEO4J_PASSWORD=12345678
export NEO4J_DATABASE=neo4j

# OpenAI (用于embeddings)
export OPENAI_API_KEY=sk-test123
```

## 运行应用

### 启动服务
```bash
python -m uvicorn app.main:app --host localhost --port 8001 --reload
```

### 访问应用
打开浏览器访问: `http://localhost:8001`

## 文件修改说明

### 1. pyproject.toml
- 修改了Python版本要求从>=3.12改为>=3.10
- 添加了setuptools包发现配置

### 2. app/resource_manager.py
- 添加了ARK API支持，使用OpenAILike类
- 配置了Neo4j连接参数
- 添加了异常处理

## 使用说明

1. 在Web界面中选择"ark-model"作为LLM
2. 选择"default"作为数据库
3. 选择合适的工作流（建议使用"text2cypher_with_1_retry_and_output_check"）
4. 输入自然语言问题，系统会自动转换为Cypher查询并执行

## 注意事项

- 确保Neo4j服务正在运行且可访问
- 如果需要APOC插件，请在Neo4j中安装
- 项目支持多种工作流，每种有不同的重试和检查机制
- 确保网络连接正常，能够访问ARK API
- 如果出现端口冲突，可以修改端口号（如8001、8002等）

## 问题解决

### 1. APOC插件缺失
如果看到错误信息 "There is no procedure with the name `apoc.meta.data` registered"，说明Neo4j缺少APOC插件。可以：

1. 下载APOC插件jar文件
2. 将其放入Neo4j的plugins目录
3. 重启Neo4j服务

### 2. 端口冲突
如果8000端口被占用，可以使用其他端口：
```bash
python -m uvicorn app.main:app --host localhost --port 8001 --reload
```

### 3. 命名冲突问题
项目已将原来的`workflows`文件夹重命名为`cypher_workflows`以避免与llama-index库的命名冲突。

## 项目文件结构

```
text2cypher_llama_agent/
├── app/                          # Web应用
│   ├── main.py                  # FastAPI应用入口
│   ├── resource_manager.py      # 模型和数据库管理
│   ├── settings.py              # 工作流配置
│   ├── static/                  # 静态文件
│   └── templates/               # HTML模板
├── cypher_workflows/            # 推理工作流
│   ├── naive_text2cypher.py     # 基础流程
│   ├── naive_text2cypher_retry.py # 带重试流程
│   ├── text2cypher_retry_check.py # 带检查流程
│   ├── iterative_planner.py     # 迭代规划
│   ├── shared/                  # 共享组件
│   └── steps/                   # 流程步骤
├── benchmark/                   # 性能测试
├── 操作步骤.md                  # 本文件
└── 推理逻辑流程.md              # 详细技术说明
``` 